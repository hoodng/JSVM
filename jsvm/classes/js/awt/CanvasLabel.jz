$package("js.awt");js.awt.CanvasLabel = function (def, Runtime, dom) {var CLASS = js.awt.CanvasLabel, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event, DOM = J$VM.DOM, System = J$VM.System, penSps = ["fontFamily", "fontSize", "fontStyle", "fontWeight", "color", "lineHeight"], fontSps = ["fontFamily", "fontSize", "fontStyle", "fontWeight"];thi$.setText = function (text) {var M = this.def;if (Class.isString(text) && text != M.labelText) {M.labelText = text;_adjust.call(this, "content");}};thi$.getText = function () {return this.def.labelText;};thi$.setWriteMode = function (mode) {var U = this._local;if (U.writeMode === mode) {return;}switch (mode) {case "bt":U.writeMode = "bt";U.rotate = -90;break;case "tb":U.writeMode = "tb";U.rotate = 90;break;default:U.writeMode = "normal";U.rotate = 0;break;}_adjust.call(this, "rotate");};thi$.getWriteMode = function () {return this._local.writeMode;};thi$.getRotate = function () {return this._local.rotate;};thi$.getX = function () {return this.def.x;};thi$.setX = function (x, fire) {this.setPosition(x, undefined, fire);};thi$.getY = function () {return this.def.y;};thi$.setY = function (y, fire) {this.setPosition(undefined, y, fire);};thi$.getPosition = function () {var M = this.def;return {x:M.x, y:M.y};};thi$.setPosition = function (x, y) {var M = this.def, bounds = this.getBounds();DOM.setPosition(this.view, x, y);M.x = bounds.x;M.y = bounds.y;_adust.call(this, "move");};thi$.getZ = function () {return this.def.z;};thi$.setZ = function (z, fire) {var M = this.def;M.z = z;this.view.style.zIndex = M.z;_adjust.call(this, "zorder");};thi$.getWidth = function () {return this.def.width;};thi$.setWidth = function (w) {this.setSize(w, undefined);};thi$.getHeight = function () {return this.def.height;};thi$.setHeight = function (h) {this.setSize(undefined, h);};thi$.getSize = function () {var M = this.def;return {width:M.width, height:M.height};};thi$.setSize = function (w, h) {var M = this.def, bounds = this.getBounds(), BBM = bounds.BBM, styleW, styleH;if ((isNaN(w) && isNaN(h)) || (isNaN(w) && h == bounds.height) || (isNaN(h) && w == bounds.width) || (w == bounds.width && h == bounds.height)) {return;}if (BBM) {styleW = w;styleH = h;} else {styleW = w - bounds.MBP.BPW;styleH = h - bounds.MBP.BPH;}if (Class.isNumber(styleW) && styleW >= 0) {bounds.width = w;}if (Class.isNumber(styleH) && styleH >= 0) {bounds.height = h;}M.width = bounds.width;M.height = bounds.height;_adjust.call(this, "resize");};thi$.getBounds = function () {var el = this.view, bounds = el.bounds || DOM.getBounds(el), position = DOM.getStyle(this.view, "position"), pounds;bounds.offsetX = el.offsetLeft;bounds.offsetY = el.offsetTop;if (J$VM.supports.borderEdg && position !== "relative") {pounds = DOM.getBounds(el.parentNode);bounds.offsetX -= pounds.MBP.borderLeftWidth;bounds.offsetY -= pounds.MBP.borderTopWidth;}bounds.x = bounds.offsetX - bounds.MBP.marginLeft;bounds.y = bounds.offsetY - bounds.MBP.marginTop;if (position == "relative") {pounds = pounds || DOM.getBounds(el.parentNode);bounds.x -= pounds.MBP.paddingLeft;bounds.y -= pounds.MBP.paddingTop;}bounds.innerWidth = bounds.width - bounds.MBP.BPW;bounds.innerHeight = bounds.height - bounds.MBP.BPH;bounds.clientWidth = el.clientWidth;bounds.clientHeight = el.clientHeight;if (this._local) {bounds.userX = this._local.userX;bounds.userY = this._local.userY;bounds.userW = this._local.userW;bounds.userH = this._local.userH;}bounds.scrollWidth = el.scrollWidth;bounds.scrollHeight = el.scrollHeight;bounds.scrollLeft = el.scrollLeft;bounds.scrollTop = el.scrollTop;return bounds;};thi$.setBounds = function (x, y, w, h) {var M = this.def, bounds = this.getBounds();DOM.setBounds(this.view, x, y, w, h, bounds);M.x = bounds.x;M.y = bounds.y;M.width = bounds.width;M.height = bounds.height;_adjust.call(this, "resize");};thi$.getPreferredSize = function (nocache) {var M = this.def, d, s;if (nocache === true) {d = this.getBounds();s = {width:d.width, height:d.height};} else {if (!M.prefSize) {d = this.getBounds();this.setPreferredSize(d.width, d.height);}s = M.prefSize;}return s;};thi$.setPreferredSize = function (w, h) {this.def.prefSize = {width:w > 0 ? w : 0, height:h > 0 ? h : 0};};thi$.isRigidWidth = function () {var v = this.def.rigid_w;return v === false ? false : true;};thi$.isRigidHeight = function () {var v = this.def.rigid_h;return v === false ? false : true;};thi$.getAlignmentX = function () {return this.def.align_x || 0;};thi$.getAlignmentY = function () {return this.def.align_y || 0;};thi$.inside = function (x, y) {var d = this.getBounds(), minX = d.absX + d.MBP.borderLeftWidth, maxX = minX + d.clientWidth, minY = d.absY + d.MBP.borderTopWidth, maxY = minY + d.clientHeight;return (x > minX && x < maxX && y > minY && y < maxY);};thi$.display = function (show) {if (show === false) {this.view.style.display = "none";_adjust(this, "display", "none");} else {this.view.style.display = "block";_adjust(this, "display", "block");}};var _adjust = function (cmd, show) {if (!this.view) {return;}var repaint = false, D = this.getBounds(), g;switch (cmd) {case "content":case "resize":case "rotate":this.adjustCover(D);repaint = true;break;case "move":this.adjustCover(D);break;case "zorder":this.setCoverZIndex(this.getZ());break;case "display":this.setCoverDisplay(show);break;case "remove":this.removeCover();break;}if (repaint) {g = this.graphic();g.setSize(D.innerWidth, D.innerHeight);_paintLabel.call(this);}};thi$.Runtime = function () {return this._local.Runtime;};thi$.graphic = function () {return this._local.graphic;};thi$.setPeerComponent = function (peer) {this.peer = peer;};thi$.getPeerComponent = function () {return this.peer;};thi$.notifyPeer = function (msgId, event, sync) {var peer = this.getPeerComponent();if (peer) {_notify.call(this, peer, msgId, event, sync);}};thi$.setContainer = function (container) {this.container = container;};thi$.getContainer = function () {return this.container;};thi$.notifyContainer = function (msgId, event, sync) {var comp = this.getContainer();if (comp) {_notify.call(this, comp, msgId, event, sync);}};var _notify = function (comp, msgId, event, sync) {sync = (sync == undefined) ? this.def.sync : sync;if (sync == true) {MQ.send(msgId, event, [comp.uuid()]);} else {MQ.post(msgId, event, [comp.uuid()]);}};thi$.isDOMElement = function () {return DOM.isDOMElement(this.view);};thi$.removeFrom = function (parentNode) {DOM.removeFrom(this.view, parentNode);_adjust.call(this, "remove");};thi$.appendTo = function (parentNode) {DOM.appendTo(this.view, parentNode);};thi$.insertBefore = function (refNode, parentNode) {DOM.insertBefore(this.view, refNode, parentNode);};thi$.insertAfter = function (refNode) {this.insertBefore(refNode.nextSibling, refNode.parentNode);};thi$.contains = function (child, constainSelf) {return DOM.contains(this.view, child, constainSelf);};thi$.repaint = function () {};thi$.doLayout = function () {};thi$.destroy = function () {arguments.callee.__super__.apply(this, arguments);delete this.view;delete this.canvas;var g = this._local.graphic;if (g) {g.clear();}delete this._local.bounds;delete this._local.graphic;delete this._local;}.$override(this.destroy);var _prepareinfo = function () {var M = this.def, U = this._local, bounds = this.view.bounds, ele, w, h, x, y, styleW, styleH, MBP, D, paintInfo, rotate = this.getRotate(), g = this.graphic(), pen = g.pen, buf = new js.lang.StringBuffer();if (!bounds) {ele = DOM.createElement("SPAN");ele.innerHTML = js.lang.String.encodeHtml(M.labelText);ele.className = this.className;ele.style.cssText = def.css || "";ele.style.whiteSpace = "nowrap";ele.style.visibility = "hidden";ele.style.position = "absolute";ele.style.top = "-10000px";ele.style.left = "-10000px";DOM.appendTo(ele, document.body);bounds = DOM.getBounds(ele);w = bounds.width;h = bounds.height;paintInfo = U.paintInfo = DOM.getStyles(ele, penSps);DOM.remove(ele, true);paintInfo.font = _getFont.call(this, paintInfo);g.setFont(paintInfo.font);w = bounds.width = g.getLabelWidth(M.labelText);this.view.bounds = D = {BBM:bounds.BBM, MBP:bounds.MBP};if (!bounds.BBM) {MBP = bounds.MBP;w = w - MBP.BPW;h = h - MBP.BPH;}if (rotate != 0) {bounds.width = h;bounds.height = w;}this.view.className = this.className;buf.append(def.css || "");if (Class.isNumber(M.x)) {x = M.x;buf.append("left:").append(M.x).append("px;");} else {x = bounds.x;}D.x = U.userX = x;if (Class.isNumber(M.y)) {y = M.y;buf.append("top:").append(M.y).append("px;");} else {y = bounds.y;}D.y = U.userY = y;styleW = Class.isNumber(M.width) ? M.width : bounds.width;D.width = styleW;if (!bounds.BBM) {styleW -= bounds.MBP.BPW;}U.userW = M.width = styleW;styleH = Class.isNumber(M.height) ? M.height : bounds.height;D.height = styleH;if (!bounds.BBM) {styleH -= bounds.MBP.BPH;}U.userH = M.height = styleH;this.view.style.cssText = buf.toString();g.setSize(styleW, styleH);}};var _initGraphic = function (dom, w, h) {var M = this.def, g = this._local.graphic, buf = new js.lang.StringBuffer();if (!g) {g = this._local.graphic = new (Class.forName("js.awt.CanvasGraphic"))({width:w, height:h}, dom);this.view = this.canvas = g.canvas();} else {if (!isNaN(w) || !isNaN(h)) {w = !isNaN(w) ? w : g.getWidth();h = !isNaN(h) ? h : g.getHeight();g.setSize(w, h);}}return g;};var _getFont = function (info) {var fontInfo = {};for (var i = 0, len = fontSps.length; i < len; i++) {sp = fontSps[i];v = info[sp];if (sp == "fontWeight" && J$VM.firefox) {var Font = Class.forName("js.awt.Font");v = Font.FFCANVASFONTWEIGHTS[v + ""] || "normal";}if (v) {fontInfo[sp] = v;}}return fontInfo;};var _getPaintInfo = function () {var M = this.def, info = this._local.paintInfo, writeMode = this.getWriteMode(), paintInfo = {}, sp, v, align_x, align_y;v = M.color || info["color"];if (v) {paintInfo["color"] = v;}paintInfo.font = info.font;paintInfo.rotate = this.getRotate();paintInfo.textOverflow = "ellipsis";switch (writeMode) {case "tb":paintInfo.ha = !isNaN(M.align_x) ? M.align_x : 0.5;paintInfo.va = !isNaN(M.align_y) ? M.align_y : 0;break;case "bt":paintInfo.ha = !isNaN(M.align_x) ? M.align_x : 0.5;paintInfo.va = !isNaN(M.align_y) ? M.align_y : 1;break;default:paintInfo.ha = !isNaN(M.align_x) ? M.align_x : 0;paintInfo.va = !isNaN(M.align_y) ? M.align_y : 0.5;break;}return paintInfo;};var _paintLabel = function () {var g = this.graphic(), D = this.getBounds(), MBP = D.MBP, x = MBP.borderLeftWidth + MBP.paddingLeft, y = MBP.borderTopWidth + MBP.paddingTop, w = D.innerWidth, h = D.innerHeight, rect = {x:x, y:y, w:w, h:h}, style = _getPaintInfo.call(this);g.drawText(this.getText(), rect, style);};thi$._init = function (def, Runtime, dom) {if (typeof def !== "object") {return;}def.classType = def.classType || "js.awt.CanvasLabel";def.className = def.className || "jsvm_canvasLabel";def.labelText = Class.isString(def.labelText) ? def.labelText : (Class.isString(def.text) ? def.text : "");this.def = def;this._local = this._local || {};this._local.Runtime = Runtime;this.uuid(def.uuid);this.id = def.id || this.uuid();this.className = def.className;this.setWriteMode(def.writeMode);_initGraphic.call(this, dom);_prepareinfo.call(this);_paintLabel.call(this);arguments.callee.__super__.apply(this, arguments);}.$override(this._init);this._init.apply(this, arguments);}.$extend(js.util.EventTarget).$implements(js.awt.Cover, js.awt.State);