$package("js.awt");$import("js.awt.Cover");$import("js.awt.Element");js.awt.BaseComponent = function (def, Runtime, view) {var CLASS = js.awt.BaseComponent, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event, DOM = J$VM.DOM, System = J$VM.System;thi$.setPosition = function (x, y, fire) {var M = this.def, bounds = this.getBounds();DOM.setPosition(this.view, x, y, bounds);M.x = bounds.x;M.y = bounds.y;this._adjust("move");}.$override(this.setPosition);thi$.setZ = function (z, fire) {var M = this.def;M.z = z;this.view.style.zIndex = M.z;this._adjust("zorder");}.$override(this.setZ);thi$.setSize = function (w, h, fire) {var M = this.def, bounds = this.getBounds();DOM.setSize(this.view, w, h, bounds);M.width = bounds.width;M.height = bounds.height;this._adjust("resize");}.$override(this.setSize);thi$.getBounds = function () {var el = this.view, bounds = DOM.getBounds(el), pounds, position = this.getStyle("position");if (position) {position = position.toLowerCase();}bounds.offsetX = el.offsetLeft;bounds.offsetY = el.offsetTop;if (J$VM.supports.borderEdg && position !== "relative") {pounds = DOM.getBounds(el.parentNode);bounds.offsetX -= pounds.MBP.borderLeftWidth;bounds.offsetY -= pounds.MBP.borderTopWidth;}bounds.x = bounds.offsetX - bounds.MBP.marginLeft;bounds.y = bounds.offsetY - bounds.MBP.marginTop;if (position == "relative") {pounds = pounds || DOM.getBounds(el.parentNode);bounds.x -= pounds.MBP.paddingLeft;bounds.y -= pounds.MBP.paddingTop;}bounds.innerWidth = bounds.width - bounds.MBP.BPW;bounds.innerHeight = bounds.height - bounds.MBP.BPH;bounds.clientWidth = el.clientWidth;bounds.clientHeight = el.clientHeight;if (this._local) {bounds.userX = this._local.userX;bounds.userY = this._local.userY;bounds.userW = this._local.userW;bounds.userH = this._local.userH;}bounds.scrollWidth = el.scrollWidth;bounds.scrollHeight = el.scrollHeight;bounds.scrollLeft = el.scrollLeft;bounds.scrollTop = el.scrollTop;return bounds;}.$override(this.getBounds);thi$.setBounds = function (x, y, w, h) {var M = this.def, bounds = this.getBounds();DOM.setBounds(this.view, x, y, w, h, bounds);M.x = bounds.x;M.y = bounds.y;M.width = bounds.width;M.height = bounds.height;this._adjust("resize");}.$override(this.setBounds);thi$.invalidateBounds = function () {this.view.bounds = null;};thi$.getPreferredSize = function (nocache) {var d;if (nocache === true) {d = this.getBounds();return {width:d.width, height:d.height};} else {if (!this.def.prefSize) {d = this.getBounds();this.setPreferredSize(d.width, d.height);}return this.def.prefSize;}};thi$.setPreferredSize = function (w, h) {this.def.prefSize = {width:w > 0 ? w : 0, height:h > 0 ? h : 0};};thi$.getMinimumSize = function (nocache) {var d;if (nocache === true) {d = this.getBounds();this.setMinimumSize(this.isRigidWidth() ? d.width : d.MBP.BPW, this.isRigidHeight() ? d.height : d.MBP.BPH);} else {d = this.def.miniSize;if (!d) {d = this.getBounds();this.setMinimumSize(this.isRigidWidth() ? d.width : d.MBP.BPW, this.isRigidHeight() ? d.height : d.MBP.BPH);}}return this.def.miniSize;};thi$.setMinimumSize = function (w, h) {this.def.miniSize = {width:w, height:h};};thi$.getMaximumSize = function (nocache) {var d;if (nocache === true) {d = this.getBounds();this.setMaximumSize(Number.MAX_VALUE, Number.MAX_VALUE);} else {d = this.def.maxiSize;if (!d) {d = this.getBounds();this.setMaximumSize(Number.MAX_VALUE, Number.MAX_VALUE);}}return this.def.maxiSize;};thi$.setMaximumSize = function (w, h) {this.def.maxiSize = {width:w, height:h};};thi$.getStyle = function (sp) {sp = DOM.camelName(sp);return DOM.currentStyles(this.view)[sp];};thi$.getStyles = function (sps) {var currents = DOM.currentStyles(this.view), styles = {}, i, len, sp;for (i = 0, len = sps.length; i < len; i++) {sp = DOM.camelName(sps[i]);styles[sp] = currents[sp];}return styles;};thi$.applyStyles = function (styles) {var el = this.view, w = parseFloat(styles.width), h = parseFloat(styles.height);delete styles.width;delete styles.height;var sizeChanged = function (value, sp) {return sp.match(/[wW]idth|padding/) != undefined;}.$some(this, styles);DOM.applyStyles(el, styles);if (sizeChanged) {this.invalidateBounds();}if (!isNaN(w) || !isNaN(h)) {this.setSize(w, h);}return sizeChanged ? this.repaint() : false;};thi$.display = function (show) {if (show === false) {this.view.style.display = "none";this._adjust("display", "none");} else {this.view.style.display = "block";this._adjust("display", "block");}}.$override(this.display);thi$.getAttribute = function (attr) {return DOM.getAttribute(this.view, attr);};thi$.setAttribute = function (attr, value) {DOM.setAttribute(this.view, attr, value);};thi$.removeAttribute = function (attr) {DOM.removeAttribute(this.view, attr);};thi$.setToolTipText = function (s) {this.def.tip = s;this.setAttribute("title", s);};thi$.delToolTipText = function () {this.def.tip = undefined;this.removeAttribute("title");};thi$.isDOMElement = function () {return DOM.isDOMElement(this.view);};thi$.removeFrom = function (parentNode) {DOM.removeFrom(this.view, parentNode);this._adjust("remove");};thi$.appendTo = function (parentNode) {DOM.appendTo(this.view, parentNode);if (this.repaint()) {this.doLayout(true);}};thi$.insertBefore = function (refNode, parentNode) {DOM.insertBefore(this.view, refNode, parentNode);if (this.repaint()) {this.doLayout(true);}};thi$.insertAfter = function (refNode) {this.insertBefore(refNode.nextSibling, refNode.parentNode);};thi$.contains = function (child, constainSelf) {return DOM.contains(this.view, child, constainSelf);}.$override(this.contains);thi$.inside = function (x, y) {var d = this.getBounds(), minX = d.absX + d.MBP.borderLeftWidth, maxX = minX + d.clientWidth, minY = d.absY + d.MBP.borderTopWidth, maxY = minY + d.clientHeight;return (x > minX && x < maxX && y > minY && y < maxY);}.$override(this.inside);thi$.relative = function (point) {var bounds = this.getBounds();return {x:point.x - bounds.absX - bounds.MBP.borderLeftWidth, y:point.y - bounds.absY - bounds.MBP.borderTopWidth};};thi$.repaint = function () {var M = this.def, U = this._local, el = this.view, bounds, ret = false;if (this.isDOMElement()) {if (this._geometric) {this._geometric();}bounds = this.getBounds();if (M.x != bounds.x || M.y != bounds.y) {DOM.setPosition(el, M.x, M.y, bounds);}if (M.width != bounds.width || M.height != bounds.height) {DOM.setSize(el, M.width, M.height, bounds);}el.style.zIndex = M.z;ret = true;}return ret;};var _geometric = function () {var M = this.def, U = this._local, bounds = this.getBounds();if (!Class.isNumber(M.x)) {M.x = bounds.x;}U.userX = M.x;if (!Class.isNumber(M.y)) {M.y = bounds.y;}U.userY = M.y;if (!Class.isNumber(M.width)) {M.width = bounds.width;if (!bounds.BBM) {M.width -= bounds.MBP.BPW;}}U.userW = M.width;if (!Class.isNumber(M.height)) {M.height = bounds.height;if (!bounds.BBM) {M.height -= bounds.MBP.BPH;}}U.userH = M.height;if (!Class.isNumber(M.z)) {var z = parseInt(this.getStyle("z-index"));M.z = Class.isNumber(z) ? z : 0;}};thi$.doLayout = function (force) {if (!this.needLayout(force) || (this.getStyle("display") === "none")) {return false;}this._local.didLayout = true;return true;};thi$.needLayout = function (force) {return force === true ? true : (!this.isRigidWidth() || !this.isRigidHeight() || !this._local.didLayout);};thi$.forceLayout = function () {this._local.didLayout = false;};thi$.activateComponent = function () {};thi$._adjust = function (cmd, show) {switch (cmd) {case "move":case "resize":this.adjustCover(this.getBounds());break;case "zorder":this.setCoverZIndex(this.getZ());break;case "display":this.setCoverDisplay(show);break;case "remove":this.removeCover();break;}};thi$.appendStyleClass = function (className) {if (Class.isString(className)) {var names = this._local.styles;if (!names) {names = [this.className];}names = names.concat(className.split(" "));this._local.styles = names;this.view.className = names.join(" ");}};thi$.removeStyleClass = function (className) {var names = this._local.styles, e;if (Class.isArray(names)) {for (var i = 0, len = names.length; i < len; i++) {e = names[i];if (e == className) {names.splice(i, 1);break;}}this.view.className = names.join(" ");}};thi$.hasStyleClass = function (className) {var names = this._local.styles, e, ret = false;if (Class.isArray(names)) {for (var i = 0, len = names.length; i < len; i++) {e = names[i];if (e == className) {ret = true;break;}}}return ret;};thi$.clearStyleClass = function (apply) {var names = this._local.styles = [this.className];if (apply === true) {this.view.className = names.join(" ");}};thi$.cloneView = function () {var ele = this.view, view = ele.cloneNode(true);view.bounds = {BBM:ele.bounds.BBM, MBP:ele.bounds.MBP};view.cloned = "true";return view;};thi$.MBP = function () {return this.getGeometric(this.className).MBP;};thi$.getGeometric = function (className) {className = className || this.className;return CLASS.G[className] || this._local.G;};var _preparegeom = function (NUCG) {NUCG = NUCG || false;CLASS.G = CLASS.G || {};var className = this.className, G = NUCG ? null : CLASS.G[className], M = this.def, ele, bounds, styleW, styleH, buf = new js.lang.StringBuffer();if (!G) {G = {};ele = this.view.cloneNode(false);ele.style.whiteSpace = "nowrap";ele.style.visibility = "hidden";ele.style.position = "absolute";ele.style.top = "-10000px";ele.style.left = "-10000px";DOM.appendTo(ele, document.body);G.bounds = DOM.getBounds(ele);DOM.remove(ele, true);if (!NUCG) {CLASS.G[className] = G;} else {this._local.G = G;}}bounds = this.view.bounds = {BBM:G.bounds.BBM, MBP:G.bounds.MBP};if (Class.isNumber(M.x)) {buf.append("left:").append(M.x).append("px;");}if (Class.isNumber(M.y)) {buf.append("top:").append(M.y).append("px;");}if (Class.isNumber(M.width)) {styleW = M.width;if (!bounds.BBM) {styleW -= bounds.MBP.BPW;}buf.append("width:").append(styleW).append("px;");}if (Class.isNumber(M.height)) {styleH = M.height;if (!bounds.BBM) {styleH -= bounds.MBP.BPH;}buf.append("height:").append(styleH).append("px;");}buf.append(this.view.style.cssText);this.view.style.cssText = buf.toString();};thi$.destroy = function () {if (this._coverView) {this.removeCover();}delete this._local;DOM.remove(this.view, true);delete this.view;arguments.callee.__super__.apply(this, arguments);}.$override(this.destroy);thi$._init = function (def, Runtime, view) {if (def == undefined) {return;}def.classType = def.classType || "js.awt.BaseComponent";arguments.callee.__super__.apply(this, arguments);if (view) {this.view = view;def.className = view.clazz || def.className;} else {this.view = view = DOM.createElement(def.viewType || "DIV");def.className = def.className || "jsvm_comp";view.clazz = view.className = def.className;}view.uuid = this.uuid();this.className = def.className;if (def.css) {view.style.cssText = view.style.cssText + def.css;}if (view.tagName != "BODY" && view.tagName != "CANVAS" && view.cloned != "true") {_preparegeom.call(this, def.NUCG);}this._geometric = function () {var o = _geometric.call(this);delete this._geometric;return o;};}.$override(this._init);this._init.apply(this, arguments);}.$extend(js.awt.Element).$implements(js.awt.Cover);