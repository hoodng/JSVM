$package("js.awt");js.awt.MoveObject = function () {var CLASS = js.awt.MoveObject, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;thi$.setMovingPeer = function (peer) {this.movingPeer = peer;};thi$.getMovingPeer = function () {return this.movingPeer;};thi$.getMovingData = function () {return {};};thi$.getMovingMsgType = function () {return "js.awt.event.MovingEvent";};thi$.getMovingMsgRecvs = function () {return null;};thi$.releaseMoveObject = function () {if (this != this.movingPeer) {delete this.movingPeer;this.destroy();} else {this.movingPeer = null;}};};js.awt.Movable = function () {var CLASS = js.awt.Movable, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event, DOM = J$VM.DOM, System = J$VM.System, MQ = J$VM.MQ;var _doSelect = function (e) {MQ.register("releaseMoveObject", this, _releaseMoveObject);Event.attachEvent(document, "mousemove", 0, this, _onmousemove);Event.attachEvent(document, "mouseup", 0, this, _onmouseup);Event.detachEvent(this.view, "mousemove", 0, this, _onmousemv1);Event.detachEvent(this.view, "mouseup", 0, this, _onmouseup1);var moveObj = this.getMoveObject(e), objContainer = moveObj.getContainer(), isAutoFit = false, rigidW = false, rigidH = false, hscroll = false, vscroll = false;if (objContainer) {rigidW = objContainer.isRigidWidth();rigidH = objContainer.isRigidHeight();if (objContainer instanceof js.awt.Container) {isAutoFit = objContainer.isAutoFit();}var styles = DOM.currentStyles(objContainer.view), overflowX = styles.overflowX, overflowY = styles.overflowY;hscroll = (overflowX === "auto" || overflowX === "scroll");vscroll = (overflowY === "auto" || overflowY === "scroll");}var bounds = moveObj.getBounds(), maxX, maxY, mW = bounds.width, mH = bounds.height, marginLf = bounds.MBP.marginLeft, marginTp = bounds.MBP.marginTop, mover = this.def.mover, grid = mover.grid, bound = mover.bound, bt = Math.max(mover.bt * mH, bound), br = Math.max(mover.br * mW, bound), bb = Math.max(mover.bb * mH, bound), bl = Math.max(mover.bl * mW, bound), pview = DOM.offsetParent(moveObj.view), cview = isAutoFit ? DOM.offsetParent(pview) : pview, pbounds = DOM.getBounds(pview);moveObj.minX = grid * Math.ceil((0 - marginLf - mW + bl) / grid);moveObj.minY = grid * Math.ceil((0 - marginTp - mH + bt) / grid);maxX = (!isAutoFit || rigidW) ? (!hscroll ? pbounds.width - pbounds.MBP.BW - marginLf - br : Math.max(pview.scrollWidth, pbounds.width) - marginLf - br) : Math.max(cview.scrollWidth, cview.offsetWidth) - marginLf - br;moveObj.maxX = maxX;maxY = (!isAutoFit || rigidH) ? (!vscroll ? pbounds.height - pbounds.MBP.BH - marginTp - bb : Math.max(pview.scrollHeight, pbounds.height) - marginTp - bb) : Math.max(cview.scrollHeight, cview.offsetHeight) - marginTp - bb;moveObj.maxY = maxY;moveObj.showMoveCover(true);moveObj.cview = cview;this._local.clickXY.x += (cview.scrollLeft - moveObj.getX());this._local.clickXY.y += (cview.scrollTop - moveObj.getY());};var _onmousedown = function (e) {e.setEventTarget(this);MQ.post("js.awt.event.LayerEvent", e, [this.Runtime().uuid()]);this.fireEvent(e);var targ = e.srcElement;if (targ.nodeType == 3) {targ = targ.parentNode;}var xy = this._local.clickXY = e.eventXY();if (e.button == 1 && !e.ctrlKey && !e.shiftKey && this.isMovable() && this.isMoverSpot(targ, xy.x, xy.y) && this.inside(xy.x, xy.y)) {var longpress = this.def.mover.longpress;longpress = Class.isNumber(longpress) ? longpress : (J$VM.env["j$vm_longpress"] || 145);Event.attachEvent(this.view, "mouseup", 0, this, _onmouseup1);_doSelect.$delay(this, longpress, e);e.cancelBubble();}return e.cancelDefault;};var _onmouseup1 = function (e) {e.setEventTarget(this);this.fireEvent(e);if (!_doSelect.$clearTimer()) {Event.detachEvent(this.view, "mouseup", 0, this, _onmouseup1);}return true;};var _onmousemv1 = function (e) {if (!System.checkThreshold(e.getTimeStamp().getTime(), 20)) {return e.cancelDefault();}return _onmouseup1.call(this, e);};var _onmousemove = function (e) {if (!System.checkThreshold(e.getTimeStamp().getTime())) {return e.cancelDefault();}_doSelect.$clearTimer();if (!this._local.notified) {MQ.post(Event.SYS_EVT_MOVING, "");this._local.notified = true;}var moveObj = this.getMoveObject(), p = moveObj.cview, bounds = moveObj.getBounds(), mover = this.def.mover, grid = mover.grid, freedom = mover.freedom, xy = e.eventXY(), oxy = this._local.clickXY, x = xy.x + p.scrollLeft - oxy.x, y = xy.y + p.scrollTop - oxy.y, minX = moveObj.minX, minY = moveObj.minY, maxX = moveObj.maxX, maxY = moveObj.maxY;x = x < minX ? minX : x > maxX ? maxX : x;y = y < minY ? minY : y > maxY ? maxY : y;if (x != bounds.x || y != bounds.y) {x = grid * Math.round(x / grid);x = (freedom & 1) != 0 ? x : undefined;y = grid * Math.round(y / grid);y = (freedom & 2) != 0 ? y : undefined;moveObj.setPosition(x, y);moveObj._moved = true;}var recvs = moveObj.getMovingMsgRecvs() || [];recvs.unshift(moveObj.getMovingPeer().uuid());e.setEventTarget(moveObj);MQ.post(moveObj.getMovingMsgType(), e, recvs);return e.cancelDefault();};var _onmouseup = function (e) {_doSelect.$clearTimer();Event.detachEvent(document, "mousemove", 0, this, _onmousemove);Event.detachEvent(document, "mouseup", 0, this, _onmouseup);MQ.post(Event.SYS_EVT_MOVED, "");this._local.notified = false;var moveObj = this.getMoveObject(), recvs = moveObj.getMovingMsgRecvs() || [];recvs.unshift(moveObj.getMovingPeer().uuid());e.setEventTarget(moveObj);MQ.post(moveObj.getMovingMsgType(), e, recvs);MQ.post("releaseMoveObject", "", [this.uuid()]);moveObj.showMoveCover(false);if (moveObj._moved) {moveObj.setPosition(moveObj.getX(), moveObj.getY(), 15);delete moveObj._moved;}return e.cancelDefault();};var _releaseMoveObject = function () {if (this.moveObj) {delete this.moveObj.cview;this.moveObj.releaseMoveObject();delete this.moveObj;}MQ.cancel("releaseMoveObject", this, _releaseMoveObject);};thi$.isMoverSpot = function (el, x, y) {return true;};thi$.getMoveObject = function (e) {var moveObj = this.moveObj;if (!moveObj) {moveObj = this.moveObj = this;moveObj.setMovingPeer(this);}return moveObj;};thi$.isMovable = function () {return this.def.movable || false;};thi$.setMovable = function (b) {this.def = this.def || {};this._local = this._local || {};b = b || false;var M = this.def, U = this._local;M.movable = b;if (b) {if (!U.moveEventAttached) {var mover = M.mover = M.mover || {};mover.longpress = Class.isNumber(mover.longpress) ? mover.longpress : 1;mover.bound = Class.isNumber(mover.bound) ? mover.bound : 20;mover.bt = Class.isNumber(mover.bt) ? mover.bt : 1;mover.br = Class.isNumber(mover.br) ? mover.br : 0;mover.bb = Class.isNumber(mover.bb) ? mover.bb : 0;mover.bl = Class.isNumber(mover.bl) ? mover.bl : 1;mover.grid = Class.isNumber(mover.grid) ? mover.grid : 1;mover.freedom = Class.isNumber(mover.freedom) ? mover.freedom : 3;Event.attachEvent(this.view, "mousedown", 0, this, _onmousedown);U.moveEventAttached = true;}} else {if (U.moveEventAttached) {Event.detachEvent(this.view, "mousedown", 0, this, _onmousedown);U.moveEventAttached = false;}}U.movableSettled = true;};thi$.movableSettled = function () {return this._local.movableSettled || false;};};