$package("js.swt");$import("js.swt.SearchKit");js.swt.Searcher = function (host, options) {var CLASS = js.swt.Searcher, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var C = js.lang.Class, L = js.util.LinkedList, System = J$VM.System;thi$.setSearchOptions = function (options) {if (typeof options == "object") {this.searchOptions = System.objectCopy(options, this.searchOptions, true);}};thi$.getSearchOptions = function () {return this.searchOptions;};var _isSet = function (v) {return (typeof v !== "undefined") && (v instanceof Array);};var _contains = function (set, e) {if (set && (typeof set.contains === "function")) {return set.contains(e);} else {if (set && C.isArray(set)) {for (var i = 0, len = set.length; i < len; i++) {var _e = set[i];if (_e === e) {return true;}}return false;} else {return false;}}};var _getTextSet = function (items, includes) {var isArray = _isSet.call(this, includes);if (!isArray) {includes = null;}var len = items.length, textSet = L.newInstance([]), item, contents;for (var i = 0; i < len; i++) {item = items[i];if (item.getContent && (typeof item.getContent === "function") && (!includes || _contains.call(this, includes, i))) {textSet.push(item.getContent());}}return textSet;};var _digestMatches = function (items, keyword, options, matchedIndexes) {var mode = options.mode, hlight = options.highlight, hStyleClass = options.highlightClass, mlen = matchedIndexes ? matchedIndexes.length : 0, len = items.length, textMatches, item;for (var i = 0; i < len; i++) {item = items[i];if (mlen > 0 && (_contains.call(this, matchedIndexes, i))) {item.setVisible(true);if (hlight && (typeof item.highlight === "function")) {textMatches = this.matches.get(i);item.highlight(keyword, mode, textMatches, hStyleClass);}} else {item.setVisible(options.keep);if (typeof item.clearHighlight === "function") {item.clearHighlight(hStyleClass);}}}};thi$.restore = function (options) {var items = this.host.getItems(), options = options || this.getSearchOptions();(function (options, item) {item.setVisible(true);if (options && options.highlight && typeof item.clearHighlight === "function") {item.clearHighlight(options.highlightClass);}}).$forEach(this, items, options);this.latestKeyword = undefined;};thi$.search = function (keyword, options) {if (typeof keyword !== "string") {return;}this.setSearchOptions(options);options = this.getSearchOptions();if (keyword.length === 0) {this.latestItems = this.host.getItems();this.restore(options);return;}var items;if (this.latestKeyword && (keyword.indexOf(this.latestKeyword) == 0)) {items = this.latestItems;} else {items = this.latestItems = this.host.getItems();}this.latestKeyword = keyword;if (!items) {return;}var isValid = _isSet.call(this, items);if (!isValid) {throw new Error("Host's getItems method returned " + "an unsupported data type.");}var textSet = _getTextSet.call(this, items);var result = js.swt.SearchKit.search(textSet, keyword, options.mode);var matches = this.matches = result ? result.matches : undefined;var matchedIndexes = L.newInstance([]);if (matches && matches.size() > 0) {matchedIndexes = L.newInstance(matches.keys());}_digestMatches.call(this, items, keyword, options, matchedIndexes);};thi$.destroy = function () {this.host = null;this.searchOptions = null;this.matches = null;this.latestItems = null;};thi$._init = function (host, options) {if (!host || (typeof host.getItems !== "function")) {throw new Error("The host is not valid.");}this.host = host;this.searchOptions = System.objectCopy(CLASS.DEFAULTSEARCHOPTIONS, {}, true);this.setSearchOptions(options);};this._init.apply(this, arguments);};js.swt.Searcher.DEFAULTSEARCHOPTIONS = {keep:false, mode:"global|ignore", highlight:true};