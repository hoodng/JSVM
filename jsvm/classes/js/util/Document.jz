$package("js.util");js.util.Document = function () {var CLASS = js.util.Document, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event, cache = {}, ATTRIBUTESCT = {acceptcharset:"acceptCharset", accesskey:"accessKey", allowtransparency:"allowTransparency", bgcolor:"bgColor", cellpadding:"cellPadding", cellspacing:"cellSpacing", "class":"className", colspan:"colSpan", checked:"defaultChecked", selected:"defaultSelected", "for":"htmlFor", frameborder:"frameBorder", hspace:"hSpace", longdesc:"longDesc", maxlength:"maxLength", marginwidth:"marginWidth", marginheight:"marginHeight", noresize:"noResize", noshade:"noShade", readonly:"readOnly", rowspan:"rowSpan", tabindex:"tabIndex", valign:"vAlign", vspace:"vSpace"}, BOOLATTRREGEXP = /^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/, DOCTYPECT = {"html-4.01":{bodysize:false}, "html-4.01-transitional":{bodysize:true}};thi$.createElement = function (type) {var el = document.createElement(type);if (el.tagName == "IMG") {this.forbidSelect(el);}return el;};var REGX_CAMEL = /[A-Z]/g, REGX_HYPHEN = /-([a-z])/ig, textSps = ["font-family", "font-size", "font-style", "font-weight", "text-decoration", "text-align", "font-weight"], camelMap = {}, hyphenMap = {};thi$.camelName = function (s) {var _s = camelMap[s];if (_s != undefined) {return _s;}_s = s.replace(REGX_HYPHEN, function (a, l) {return l.toUpperCase();});camelMap[s] = _s;if (_s !== s) {hyphenMap[_s] = s;}return _s;};thi$.hyphenName = function (s) {var _s = hyphenMap[s];if (_s !== undefined) {return _s;}_s = s.replace(REGX_CAMEL, function (u) {return "-" + u.toLowerCase();});hyphenMap[s] = _s;if (_s !== s) {camelMap[_s] = s;}return _s;};thi$.offsetParent = function (ele) {var body = document.body, p = ele.offsetParent;if (!p || !this.contains(body, p, true)) {p = body;}return p;};thi$.currentStyles = function (el, isEle) {var defaultView = document.defaultView, ret;isEle = isEle === undefined ? this.isDOMElement(el) : isEle;if (isEle) {if (defaultView && defaultView.getComputedStyle) {ret = defaultView.getComputedStyle(el, null);} else {ret = el.currentStyle;}} else {ret = {};}return ret;};var _pretreatProp = function (sp) {if (sp == "float") {return J$VM.supports.supportCssFloat ? "cssFloat" : "styleFloat";} else {return this.camelName(sp);}};thi$.getStyle = function (el, sp) {if (el == document) {return null;}var defaultView = document.defaultView;var cs, prop = _pretreatProp.call(this, sp);if (defaultView && defaultView.getComputedStyle) {var out = el.style[prop];if (!out) {cs = defaultView.getComputedStyle(el, "");out = cs ? cs[prop] : null;}if (prop == "marginRight" && out != "0px" && !J$VM.supports.reliableMarginRight) {var display = el.style.display;el.style.display = "inline-block";out = defaultView.getComputedStyle(el, "").marginRight;el.style.display = display;}return out;} else {if (sp == "opacity") {if (el.style.filter.match) {var matches = el.style.filter.match(/alpha\(opacity=(.*)\)/i);if (matches) {var fv = parseFloat(matches[1]);if (!isNaN(fv)) {return fv ? fv / 100 : 0;}}}return 1;}return el.style[prop] || ((cs = el.currentStyle) ? cs[prop] : null);}};thi$.getStyles = function (el, sps) {var styles = {};(function (styles, el, sp) {styles[this.camelName(sp)] = this.getStyle(el, sp);}).$forEach(this, sps || [], styles, el);return styles;};thi$.getAttribute = function (el, attr) {if (!el || el.nodeType !== 1 || !attr) {return "";}var tmp = attr.toLowerCase(), prop = tmp, v;if (J$VM.ie) {prop = ATTRIBUTESCT[attr] || ATTRIBUTESCT[tmp] || attr;} else {prop = tmp;}if (J$VM.ie) {v = el[prop];}if (!v) {v = el.getAttribute(attr);}if (BOOLATTRREGEXP.test(tmp)) {if (el[prop] === true && v === "") {return tmp;}return v ? tmp : "";}return v ? "" + v : "";};thi$.hasAttribute = function (el, attr) {if (el.hasAttribute) {return el.hasAttribute(attr);}return el.getAttribute(attr) != null;};thi$.setAttribute = function (el, attr, value) {if (!el || el.nodeType !== 1 || !attr) {return;}var prop = attr.toLowerCase(), v;if (J$VM.ie) {attr = ATTRIBUTESCT[attr] || ATTRIBUTESCT[prop] || attr;} else {attr = prop;}if (BOOLATTRREGEXP.test(prop)) {if (Class.isString(value)) {v = (value.toLowerCase() === "true");} else {v = (value === true);}if (v) {el.setAttribute(attr, "" + v);} else {el.removeAttribute(attr);}return;}v = Class.isValid(value) ? "" + value : "";if (v.length > 0) {el.setAttribute(attr, v);} else {el.removeAttribute(attr);}};thi$.removeAttribute = function (el, attr) {el.removeAttribute(attr);};thi$.setOpacity = function (el, value) {var style = el.style, currentStyle = el.currentStyle;if (J$VM.ie && parseInt(J$VM.ie) < 10) {var opacity = isNaN(value) ? "" : "alpha(opacity=" + value * 100 + ")";var filter = currentStyle && currentStyle.filter || style.filter || "";filter = filter.replace(/alpha\(opacity=(.*)\)/i, "").replace(/(^\s*)|(\s*$)/g, "");style.zoom = 1;var filterVal = new js.lang.StringBuffer();filterVal = filterVal.append(filter);filterVal = filter.length > 0 ? filterVal.append(" ") : filterVal;filterVal = filterVal.append(opacity);style.filter = filterVal.toString();} else {style.opacity = value;}};thi$.clearOpacity = function (el) {var style = el.style;if (J$VM.ie) {var filter = style.filter;style.filter = filter ? filter.replace(/alpha\(opacity=(.*)\)/i, "").replace(/(^\s*)|(\s*$)/g, "") : "";} else {style.opacity = style["-moz-opacity"] = style["-khtml-opacity"] = "";}};thi$.applyStyles = function (el, styles) {(function (el, value, sp) {if (sp.toLowerCase() == "opacity") {this.setOpacity(el, value);} else {sp = _pretreatProp.call(this, sp);el.style[sp] = value;}}).$map(this, styles || {}, el);};thi$.parseNumber = function (value) {var i = Class.isValid(value) ? parseInt(value) : 0;if (Class.isNumber(i)) {return i;}switch (value.toLowerCase()) {case "thin":return 1;case "medium":return 3;case "thick":return 5;default:return 0;}};thi$.getBorderWidth = function (el, currentStyles, isEle) {var bounds = el.bounds;if (!bounds) {bounds = el.bounds = {};}if (!bounds.MBP || !bounds.MBP.borderTopWidth) {var MBP = bounds.MBP = bounds.MBP || {};isEle = isEle === undefined ? this.isDOMElement(el) : isEle;currentStyles = currentStyles || this.currentStyles(el, isEle);var bs = currentStyles["borderTopStyle"].toLowerCase();MBP.borderTopWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderTopWidth"]));bs = currentStyles["borderRightStyle"].toLowerCase();MBP.borderRightWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderRightWidth"]));bs = currentStyles["borderBottomStyle"].toLowerCase();MBP.borderBottomWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderBottomWidth"]));bs = currentStyles["borderLeftStyle"].toLowerCase();MBP.borderLeftWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderLeftWidth"]));}return bounds.MBP;};thi$.getPadding = function (el, currentStyles, isEle) {var bounds = el.bounds;if (!bounds) {bounds = el.bounds = {};}if (!bounds.MBP || !bounds.MBP.paddingTop) {var MBP = bounds.MBP = bounds.MBP || {};isEle = isEle === undefined ? this.isDOMElement(el) : isEle;currentStyles = currentStyles || this.currentStyles(el, isEle);MBP.paddingTop = this.parseNumber(currentStyles["paddingTop"]);MBP.paddingRight = this.parseNumber(currentStyles["paddingRight"]);MBP.paddingBottom = this.parseNumber(currentStyles["paddingBottom"]);MBP.paddingLeft = this.parseNumber(currentStyles["paddingLeft"]);}return bounds.MBP;};thi$.getMargin = function (el, currentStyles, isEle) {var bounds = el.bounds;if (!bounds) {bounds = el.bounds = {};}if (!bounds.MBP || !bounds.MBP.marginTop) {var MBP = bounds.MBP = bounds.MBP || {};isEle = isEle === undefined ? this.isDOMElement(el) : isEle;currentStyles = currentStyles || this.currentStyles(el, isEle);MBP.marginTop = this.parseNumber(currentStyles["marginTop"]);MBP.marginRight = this.parseNumber(currentStyles["marginRight"]);MBP.marginBottom = this.parseNumber(currentStyles["marginBottom"]);MBP.marginLeft = this.parseNumber(currentStyles["marginLeft"]);}return bounds.MBP;};thi$.getBoundRect = function (el, isEle) {isEle = isEle === undefined ? this.isDOMElement(el) : isEle;return isEle ? el.getBoundingClientRect() : {left:0, top:0, bottom:0, right:0};};var _computeByBody = function () {var doctype = J$VM.doctype, fValues = [], b = true, v, table;if (doctype.declared) {v = doctype.getEigenStr();if (v) {table = DOCTYPECT[v];b = table ? (table["bodysize"] || false) : false;} else {b = false;}}return b;};thi$.outerSize = function (el, isEle) {if (el.tagName !== "BODY") {var r = this.getBoundRect(el, isEle);return {left:r.left, top:r.top, width:r.right - r.left, height:r.bottom - r.top};} else {var b = _computeByBody.call(this);return {left:0, top:0, width:b ? document.body.clientWidth : document.documentElement.clientWidth, height:b ? document.body.clientHeight : document.documentElement.clientHeight};}};thi$.outerWidth = function (el, isEle) {return this.outerSize(el, isEle).width;};thi$.outerHeight = function (el, isEle) {return this.outerSize(el, isEle).height;};thi$.innerSize = function (el, currentStyles, isEle) {var o = this.outerSize(el, isEle), b = this.getBorderWidth(el, currentStyles, isEle), p = this.getPadding(el, currentStyles, isEle);return {width:o.width - b.borderLeftWidth - b.borderRightWidth - p.paddingLeft - p.paddingRight, height:o.height - b.borderTopWidth - b.borderBottomWidth - p.paddingTop - p.paddingBottom};};thi$.innerWidth = function (el, currentStyles, isEle) {return this.innerSize(el, currentStyles, isEle).width;};thi$.innerHeight = function (el, currentStyles, isEle) {return this.innerSize(el, currentStyles, isEle).height;};thi$.setSize = function (el, w, h, bounds) {bounds = bounds || this.getBounds(el);var BBM = bounds.BBM, styleW, styleH, isCanvas = (el.tagName === "CANVAS");if (BBM) {styleW = w;styleH = h;} else {styleW = w - bounds.MBP.BPW;styleH = h - bounds.MBP.BPH;}if (Class.isNumber(styleW) && styleW >= 0) {bounds.width = w;if (isCanvas) {el.width = styleW;} else {el.style.width = styleW + "px";}}if (Class.isNumber(styleH) && styleH >= 0) {bounds.height = h;if (isCanvas) {el.height = styleH;} else {el.style.height = styleH + "px";}}};thi$.absXY = function (el, isEle) {var r = this.getBoundRect(el, isEle);return {x:r.left, y:r.top};};thi$.absX = function (el, isEle) {return this.absXY(el, isEle).x;};thi$.absY = function (el, isEle) {return this.absXY(el, isEle).y;};thi$.offsetXY = function (el) {return {x:el.offsetLeft, y:el.offsetTop};};thi$.offsetX = function (el) {return this.offsetXY(el).x;};thi$.offsetY = function (el) {return this.offsetXY(el).y;};thi$.setPosition = function (el, x, y, bounds) {bounds = bounds || this.getBounds(el);if (Class.isNumber(x)) {bounds.x = x;el.style.left = x + "px";}if (Class.isNumber(y)) {bounds.y = y;el.style.top = y + "px";}};thi$.getBounds = function (el) {var isEle = _checkElement.call(this, el), outer = this.outerSize(el, isEle), bounds = el.bounds = el.bounds || {};if (bounds.BBM === undefined) {if (Class.typeOf(el) === "htmlinputelement" || Class.typeOf(el) === "htmltextareaelement") {bounds.BBM = J$VM.supports.iptBorderBox;} else {bounds.BBM = J$VM.supports.borderBox;}var currentStyles = this.currentStyles(el, isEle);this.getMargin(el, currentStyles, isEle);this.getPadding(el, currentStyles, isEle);this.getBorderWidth(el, currentStyles, isEle);var MBP = bounds.MBP;MBP.BW = MBP.borderLeftWidth + MBP.borderRightWidth;MBP.BH = MBP.borderTopWidth + MBP.borderBottomWidth;MBP.PW = MBP.paddingLeft + MBP.paddingRight;MBP.PH = MBP.paddingTop + MBP.paddingBottom;MBP.BPW = MBP.BW + MBP.PW;MBP.BPH = MBP.BH + MBP.PH;}bounds.width = outer.width;bounds.height = outer.height;bounds.absX = outer.left;bounds.absY = outer.top;return bounds;};thi$.setBounds = function (el, x, y, w, h, bounds) {this.setPosition(el, x, y, bounds);this.setSize(el, w, h, bounds);};thi$.hasScrollbar = function (el) {var MBP = this.getBounds(el).MBP, vbw = el.offsetWidth - el.clientWidth - MBP.BW, hbw = el.offsetHeight - el.clientHeight - MBP.BH;return {vbw:vbw, hbw:hbw, vscroll:vbw > 1, hscroll:hbw > 1};};thi$.removeFun = function (el) {if (!el) {return;}if (el.nodeType == 1) {var handlers = el.__handlers__, eventType;if (handlers) {for (eventType in handlers) {Event.detachEvent(el, eventType);}}el.__handlers__ = undefined;el.bounds = undefined;}var a = el.attributes, i, l, n;if (a) {for (i = a.length - 1; i >= 0; i--) {n = a[i].name;if (typeof el[n] === "function") {el[n] = null;}}}a = el.childNodes;if (a) {for (i = 0, l = a.length; i < l; i++) {arguments.callee(a.item(i));}}};thi$.remove = function () {var p;return function (el, gc) {if (!el) {return;}if (gc) {this.removeFun(el);if (Class.typeOf(el) != "htmlbodyelement") {p = p || document.createElement("DIV");p.appendChild(el);p.innerHTML = "";}}if (el.parentNode) {el.parentNode.removeChild(el);}};}();thi$.removeFrom = function (el, parentNode) {if (!el) {return;}parentNode = parentNode || el.parentNode;parentNode.removeChild(el);};thi$.appendTo = function (el, parentNode) {parentNode.appendChild(el);};thi$.insertBefore = function (el, refNode, parentNode) {parentNode = parentNode || refNode.parentNode;if (refNode) {parentNode.insertBefore(el, refNode);} else {parentNode.appendChild(el);}};thi$.insertAfter = function (el, refNode) {this.insertBefore(el, refNode.nextSibling, refNode.parentNode);};thi$.contains = function (el, child, containSelf) {if (el == null || el == undefined || child == null || child == undefined) {return false;}if (el.compareDocumentPosition) {var res = el.compareDocumentPosition(child);if (containSelf && res === 0) {return true;} else {return res === 20;}} else {if (containSelf && el === child) {return true;} else {return el.contains(child);}}};thi$.isDOMElement = function (el) {return this.contains(document.body, el, true);};var _checkElement = function (el) {if (!this.isDOMElement(el)) {var err = "The element " + (el.id || el.name) + " is not a DOM element.";J$VM.System.err.println(err);return false;}return true;};var _breakEventChian = function (e) {if (e.getType() == "selectstart") {var el = e.srcElement, elType = Class.typeOf(el);if (elType == "htmlinputelement" || elType == "htmltextareaelement") {return true;}}e.cancelBubble();return e.cancelDefault();};thi$.forbidSelect = function (el) {if (typeof document.onselectstart != "function") {Event.attachEvent(document, "selectstart", 1, this, _breakEventChian);}if (typeof el.ondragstart != "function") {Event.attachEvent(el, "dragstart", 1, this, _breakEventChian);}};thi$.toCssText = function (styles) {if (typeof styles !== "object") {return "";}if (typeof styles !== "object") {return "";}var buf = new js.lang.StringBuffer(), p, v;for (p in styles) {v = styles[p];p = this.hyphenName(p);buf.append(p).append(":").append(v).append(";");}return buf.toString();};thi$.getStringSize = function (str, styles) {var textNode = this.createElement("SPAN");textNode.innerHTML = str;textNode.style.cssText = this.toCssText(styles);this.appendTo(textNode, document.body);var s = this.outerSize(textNode);this.remove(textNode, true);textNode = null;return s;};thi$.getTextSize = function (span) {if (!span || span.tagName !== "SPAN") {return {width:0, height:0};}var styles = {display:"inline", "white-space":"nowrap", position:"absolute", left:"-10000px", top:"-10000px"};styles = J$VM.System.objectCopy(styles, this.getStyles(span, textSps) || {});return this.getStringSize(span.innerHTML, styles);};thi$.setHTML = function (el, html) {if (J$VM.ie) {while (el.firstChild) {el.removeChild(el.firstChild);}try {el.innerHTML = "<br />" + html;el.removeChild(el.firstChild);}catch (e) {var tempDiv = this.create("div");tempDiv.innerHTML = "<br />" + html;var children = tempDiv.childNodes, len = children ? children.length : 0;for (var i = 1; i < len; i++) {el.appendChild(children[i]);}}} else {el.innerHTML = html;}return el;};thi$.addStyle = function (css, doc) {doc = doc || document;if (!css || !doc) {return;}var head = doc.getElementsByTagName("head")[0], styleElements = head.getElementsByTagName("style"), styleElement, media, tmpEl;if (styleElements.length == 0) {if (J$VM.ie) {doc.createStyleSheet();} else {tmpEl = doc.createElement("style");tmpEl.setAttribute("type", "text/css");head.appendChild(tmpEl);}}styleElement = styleElements[0];media = styleElement.getAttribute("media");if (media != null && !/screen/.test(media.toLowerCase())) {styleElement.setAttribute("media", "screen");}if (J$VM.ie) {styleElement.styleSheet.cssText += css;} else {if (J$VM.firefox) {styleElement.innerHTML += css;} else {styleElement.appendChild(doc.createTextNode(css));}}};}.$extend(js.lang.Object);